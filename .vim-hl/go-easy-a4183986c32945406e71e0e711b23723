<span class="Statement">var</span> (
    jobs    = <span class="Constant">20</span>                 <span class="Comment">// Run 20 jobs in total.</span>
    running = <span class="Statement">make</span>(<span class="Type">chan</span> <span class="Type">bool</span>, <span class="Constant">3</span>) <span class="Comment">// Limit concurrent jobs to 3.</span>
    done    = <span class="Statement">make</span>(<span class="Type">chan</span> <span class="Type">bool</span>)    <span class="Comment">// Signal that all jobs are done.</span>
)

<span class="Statement">for</span> i := <span class="Constant">0</span>; i &lt;= jobs; i++ {
    running &lt;- <span class="Constant">true</span> <span class="Comment">// Fill running; this will block and wait if it's already full.</span>

    <span class="Comment">// Start a job.</span>
    <span class="Statement">go</span> <span class="Statement">func</span>(i <span class="Type">int</span>) {
        <span class="Statement">defer</span> <span class="Statement">func</span>() {
            &lt;-running      <span class="Comment">// Drain running so new jobs can be added.</span>
            <span class="Statement">if</span> i == jobs { <span class="Comment">// Last job, signal that we're done.</span>
                done &lt;- <span class="Constant">true</span>
            }
        }()

        <span class="Comment">// &quot;do work&quot;</span>
        time.Sleep(<span class="Constant">1</span> * time.Second)
        fmt.Println(i)
    }(i)
}

&lt;-done <span class="Comment">// Wait until all jobs are done.</span>
fmt.Println(<span class="Constant">&quot;done&quot;</span>)
