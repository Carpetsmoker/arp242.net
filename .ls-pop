#!/bin/sh

psql goatcounter --no-align -Etqc \
	"select \
		count(first_visit) as count, \
		path, \
		(select title from hit_stats where site=1 and event=0 and hit_stats.path=hits.path order by day desc limit 1) \
	from hits \
		where \
			site=1 and \
			bot=0 and \
			event=0 and \
			title != '404' \
		group by path \
		order by count desc;" |
	grep -v '^.|' |
	sed -E 's!([0-9]+?)\|(.+?)\|(.+?)$!<li><span>{{\1|number_format}}</span> <a href="\2">\3</a></li>!'
